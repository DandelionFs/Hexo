---
title: clash
---







## 前言

`Clash`是一款用`Go`开发的支持`Linux`/`MacOS`/`Windows`等多平台的代理工具，支持`ss`/`v2ray`/`snell`（不支持`ssr`），支持规则分流（类似于 Surge 的配置）。

项目地址：

- 原项目：[Clash](https://github.com/Dreamacro/clash)

Clash for macOS：[ClashX](https://github.com/yichengchen/clashX/)Clash for Windows：[Clash for Windows](https://github.com/Fndroid/clash_for_windows_pkg/)

- （以下内容基于正式版，测试版内容不作介绍）

本文主要介绍`Clash for Windows`（下文中可能会简称为 CFW）的使用方法，之前 Windows 上的`Clash`只有命令行界面，感谢 [Fndroid](https://github.com/Fndroid)

 开发的图形界面，让我们的使用变得更加简单有效率。

**提示**：若之前没有接触过策略分流的软件（如 Surge、圈），学习使用 CFW 之前也可以自己熟悉了解下策略组、规则等等（特别是没有托管需要自己编辑配置文件的用户），多看看规则文件（例如 [神机规则](https://github.com/ConnersHua/Profiles/blob/master/Clash/Pro.yaml)

 ），同时推荐看下 Fndroid 大佬的[关于策略组的理解](https://github.com/Fndroid/jsbox_script/wiki/关于策略组的理解)

，掌握了策略分流的概念后，Clash、Quantumult、Surge、Surfboard 等工具的使用也能更清晰明白了。

## 准备工作

- 安装版：下载 [Clash.for.Windows.Setup.exe](https://github.com/Fndroid/clash_for_windows_pkg/releases)

 ([备用地址](https://asset.10101.io)

 `帐号/密码：10101.io/10101.io`), 安装并打开。
   **注意**：首次开启后不用急着操作，CFW 会自己下载必要的文件，左下角显示`Connected to Clash`后即可进行接下来的操作。

免安装版：下载[Clash.for.Windows.7z](https://github.com/Fndroid/clash_for_windows_pkg/releases)

，解压后运行`Clash.for.Windows.exe`。
**注意**：如果想要使用便携模式（如将`.7z`解压至移动硬盘、U盘等），需将`config.yml`和[Country.mmdb](https://asset.10101.io/externalLinksController/chain/Country.mmdb?ckey=8hY08nReECvarf4iCbIHXFlx80mL43thUQmjf6KnKh512UdFMDeEn%2BH5I%2BkJOnl%2F)

- 放置在软件目录下`resources/static/files`文件夹中。

## Clash for Windows 界面简介

[![clash-ui.png](https://10101.io/usr/uploads/2019/11/3984872114.png)](https://10101.io/usr/uploads/2019/11/3984872114.png)

[clash-ui.png](https://10101.io/usr/uploads/2019/11/3984872114.png)



- `General（常规）`：
  - `Port`、`Socks Port`；分别为 HTTP、SOCKS 代理端口，点击终端图案可以打开一个配置了代理的命令行窗口，点击端口数字可以复制该命令；
  - `Allow LAN`：启用局域网共享代理功能，此开关仅为短暂开启，如需启用请在修改配置文件中进行修改；‘
  - `Log Level`：日志等级；
  - `Home Directory`：点击下方路径直达`C:\Users\用户名\.config\clash`文件夹；
  - `GeoIP Database`：点击下方日期可更新 GeoIP 数据库；
  - `UWP Loopback` ：可以用来使 UWP 应用解除回环代理限制；
  - `Tap Device` ：安装 cfw-tap 网卡，可用于处理不遵循系统代理的软件（实际启动 tap 模式需要更改配置文件）；
  - `Text Mode Edit`：编辑`config.yml`文件，可用于配置部分 **General** 页面内容；
  - `Dark Theme`：控制暗色模式；
  - `System Proxy`：启用系统代理；
  - `Start with Windows`：设置开机自启；
- `Proxies（代理）`：选择代理方式（Global-全局、Rule-规则、Direct-直连）及策略组节点选择；
- `Profiles（配置管理）`：
  - 用来下载远端配置文件和创建本地副本，且可在多个配置文件间切换；
  - 对配置进行节点、策略组和规则的管理（添加节点、策略组和规则在各自编辑界面选择`Add`, 调整策略组顺序、节点顺序及策略组节点使用拖拽的方式）；
- `Logs（日志）`：显示当前请求命中规则类型和策略；
- `Connections (连接)`: 显示当前的 TCP 连接，可对某个具体连接执行关闭操作；
- `Feedback（反馈）`：显示软件、作者相关信息，内含捐赠码，欢迎打赏[Fndroid](https://github.com/Fndroid)

- 大佬以感谢和支持开发。

**注意**：更多更详细介绍可以查看[官方文档](https://docs.cfw.lbyczf.com/)

。

## 添加配置文件

### 有托管 / 订阅情况

- 如果机场直接提供 Clash 托管配置，复制好托管链接，直接看[具体步骤](https://10101.io/2018/10/27/how-to-use-clash-for-windows#具体步骤)；
- 如果拥有 Surge 托管，可以使用 [Fndroid](https://github.com/Fndroid)

-  大佬提供的接口转换 Surge 配置为 Clash 可用配置。  
  **接口使用方法**：`https://tgbot.lbyczf.com/surge2clash?url=Surge托管地址`；例：托管地址为`http://example.com`, 那么使用接口后的远端配置地址为`https://tgbot.lbyczf.com/surge2clash?url=http://example.com`。
- 如果拥有 v2ray/ss 订阅链接或者 Surge 托管，均可以使用我利用 subconverter 搭建的接口，转换为 Clash 配置（策略组将替换为我设定的策略，规则使用神机规则）
     **接口使用方法**：`https://api.10101.io/sub?target=clash&url=URLEncode后的托管或者订阅链接`；例如，v2ray 订阅链接为 `http://example.com`，那么使用接口后的 clash 配置地址为 `https://api.10101.io/sub?target=clash&url=http%3a%2f%2fexample.com`。

#### 具体步骤

1. 打开`clash for windows`，选择`Profiles`；
2. 在`Download from a URL`中填写`Clash托管链接`或`使用接口后的Surge托管地址`，然后点击`Download`, 成功更新并启动后左下角应显示为`Connected to Clash core`，见下图①②③；  
    [![remote_configuration](https://10101.io/usr/uploads/2020/02/1572823557.png)remote_configuration](https://10101.io/usr/uploads/2020/02/1572823557.png)
3. 点击`Proxies`，选择`Rule`，为自己的策略组挑选节点；
4. 点击`General`, 勾选`System Proxy（系统代理）`。（可选，不懂建议勾选）

#### 注意

初次启动时，CFW 自带了一个简单的配置文件，里面有一个名为`Shadowsocks`的`socks5`类型`1080`端口的本地代理，如果接口或者 Clash 托管链接被墙可以用别的软件开启代理作为 CFW 的前置代理，端口为`1080`。

### 无托管 / 订阅情况

如果没有 Clash/Surge 托管或者 V2Ray/ss 订阅链接的话，解决方法有以下三种（方法一推荐作为小幅度修改使用，编写大量配置时方法二更为方便）：

#### 方法一：利用 UI 配置

1. 当`Profiles`中为空时，会自动生成一个`config.yml`文件的配置副本，可以直接对它进行编辑；
2. 点击对应图案分别进入节点（组）或者规则的编辑模式；  
      [![local_configuration](https://10101.io/usr/uploads/2020/02/2056420523.png)local_configuration](https://10101.io/usr/uploads/2020/02/2056420523.png)
3. 例如，点击"飞机"图案进入节点和策略组编辑界面（添加规则同理），完成后点击`Save`保存，如下图：
      [![clash-add-proxy.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=)clash-add-proxy.png](https://i.loli.net/2018/12/12/5c10a59f3c5da.png)
4. 在`Proxies`中为各个策略组选择节点使用；
5. 点击`General`, 勾选`System Proxy（系统代理）`。（可选，建议勾选）

**注意**：第4、5步为通用步骤，下面将不再说明。

#### 方法二：直接修改配置文件

有以下两种方式，推荐使用第二种方式，编辑器推荐使用 [Notepad++](https://notepad-plus-plus.org/download/v7.5.9.html)

 ，配置格式请参考 [神机规则](https://github.com/ConnersHua/Profiles/blob/master/Clash/Pro.yaml)

（~~编写策略组时注意**被引用的策略组要放在引用它的策略组之前**~~）：

1. 编辑`C:\Users\用户名\.config\clash`文件夹下的`config.yml`文件，然后删除`profiles`文件夹，重启 CFW，则会在`Profiles`中看到生成的`config.yml`副本；
2. 由于`Profiles`功能的加入，更推荐对`C:\Users\用户名\.config\clash\profiles`文件夹下的配置文件（若为 Local 文件直接在软件`Profiles`页面点击“铅笔状”图标即可打开）进行修改。

**注意**：

- General 部分信息由`config.yml`中对应部分决定，与`Profiles`中的配置文件无关；
- 可以直接拖拽`yml`格式的配置文件到`Profiles`面板中快速导入，详见操作示例（来自 Fndroid 大佬的 [GitHub](https://github.com/Fndroid/clash_for_windows_pkg)

- ）：
    [![img](https://pic3.superbed.cn/item/5cab58103a213b0417e3a652.gif)](https://pic3.superbed.cn/item/5cab58103a213b0417e3a652.gif)

#### 方法三：利用 JSBox 脚本

iOS 用户可以利用 [Fndroid](https://github.com/Fndroid)

 大佬的 [JSBox](https://itunes.apple.com/us/app/jsbox-learn-to-code/id1312014438?mt=8) 脚本—— [lhie1 规则生成](https://xteko.com/install?id=77&lang=zh-Hans)——添加节点，然后将脚本目录下的`data.js`发送给托管机器人 [rules_lhie1_bot](https://telegram.me/rules_lhie1_bot)

 即可获取 Surge 托管链接，再按照以上[有托管 / 订阅链接情况](https://10101.io/2018/10/27/how-to-use-clash-for-windows#有托管+%2f+订阅情况)操作。

## CFW 自定义字段

以下字段均可在 `config.yaml` 中定义

- `cfw-profiles-path`
    用于自定义 `Profiles` 目录路径

- `cfw-tray-icon`
    用于自定义状态栏图标

  ```yaml
  cfw-tray-icon: 
    default: path/to/ico           # 默认图标
    system-proxy-on: path/to/ico   # 开启系统代理后图标
  ```

- `cfw-font-family`
    用于自定义 CFW 字体

- `cfw-proxies-order`
    用于自定义节点排序，可用参数 `default` / `latency` / `alphabet`

- `cfw-http-headers`
    用于自定义配置文件下载时的请求头

## 设置开机自启

> `v0.5.19`更新加入了开机自启支持：在`General`页面勾选`Start with Windows`。

~~软件内没有开机自启选项~~，如果需要开机自启，可以自己在系统启动中加上，以 win10 为例，具体步骤如下：

1. `win+R`打开运行框，然后输入`shell:startup`，点确定；或者自己打开以下文件夹`C:\Users\用户名\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup`;  
    [![shell-startup.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=)shell-startup.png](https://i.loli.net/2018/10/29/5bd6f16873b83.png)
2. 将`clash for windows`的快捷方式复制一份放在该文件夹下。  
    [![启动.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+IEmuOgAAAA1JREFUCJljePfx038ACXMD0ZVlJAYAAAAASUVORK5CYII=)启动.png](https://i.loli.net/2018/10/29/5bd6f16811872.png)

## 其他小提示

- 可点击`General`页面的`Clash for Windows`字样重启客户端，点击旁边的版本号可以检查更新，点击小猫咪可以开启暗黑模式；
- `General`页面的信息只能通过修改`C:\Users\用户名\.config\clash\config.yml`来更改，即`profiles`中的配置文件内包含的 General 信息不会生效；
- 若不想启用系统代理的话，需要自己配置 http 或 socks5 代理，具体端口信息可以在`General`页面找到；
- 当 Surge 托管链接的`URL参数`在两个及以上(由`&`连接)的话，请先对托管连接进行 [URL 编码](http://tool.chinaz.com/tools/urlencode.aspx)

；

图标状态显示：蓝色——默认；红色——核心启动失败；黄色——系统代理开启；

`v0.4.5`版本后可以自定义系统代理需要绕过的域名或 IP ，用于解决部分应用检测代理后拒绝响应的问题（如 UWP 版网易云音乐）。具体编写方法见[官方文档——绕过系统代理](https://docs.cfw.lbyczf.com/contents/bypass.html)

；（建议在`C:\Users\用户名\.config\clash\config.yml`中修改，这样可以在不同的配置文件中都起到作用）

如果需要 UWP 应用走系统代理的话，可以点击打开`General`页面的`EnableLoopback.exe`，然后勾选需要代理的应用后保存；对于少数不遵守系统代理的 UWP 应用，可以使用 Tap 模式（详见 [TAP 模式](https://docs.cfw.lbyczf.com/contents/tap.html)

- ）。

## 常见错误及解决办法

若一切弄好之后还是显示`Disconnected to Clash`，可打开`C:\Users\用户名\.config\clash\logs`文件夹（点击左下角核心状态显示可直达 log 文件夹），打开最新的日志文件查看错误。（实在无法解决可加入作者 telegram 群 [Fndroid 脚本/API 讨论](https://t.me/fndroid_group)

寻求帮助）

- `Can't load mmdb: error opening database: invalid MaxMind DB file`错误。  
     **解决办法**：自行下载 [Country.mmdb](https://asset.10101.io/externalLinksController/chain/Country.mmdb?ckey=8hY08nReECvarf4iCbIHXFlx80mL43thUQmjf6KnKh512UdFMDeEn%2BH5I%2BkJOnl%2F)

-  文件覆盖。
- 拨号连接用户IE代理正常，其他浏览器系统代理无法使用。
     **解决办法**：重命名拨号连接，将中文名更改为英文名字，然后重启。
- 打开 Profiles 界面空白无内容
     **解决办法**：打开 Home Directory，删除文件夹下所有内容后重启软件。

------

## 更新日志

- 2018-10-29    增加设置开机自启说明；
- 2018-11-02    根据`v0.3.0`版本对内容进行更改；
- 2018-11-07    根据[官方文档](https://docs.cfw.lbyczf.com/)

对部分内容进行修改；

2018-11-08    添加`Can not download the configuration file`错误可能解决办法；

2018-11-11    根据`v0.3.5`版本对内容进行更改；

2018-11-18    根据`v0.4.0`版本对内容进行更改；

2018-11-27    删除部分过时内容；

2018-11-29    小补充；

2018-12-02    根据`v0.5.1`版本对内容进行更改；

2018-12-12    根据`v0.5.5`版本对无托管时的 UI 配置方式重新介绍；

2018-12-16    根据`v0.5.8`版本进行调整，并且重新介绍无托管时的配置文件修改；

2019-06-30    根据`v0.6.0`版本进行简单修改；

2019-08-02    根据`v0.7.0`版本进行简单修改；

2019-08-26    根据`v0.7.5`版本更新说明，替换部分图片；（F 大劳模）

2019-09-10    根据`v0.7.7`版本更新；（F 大辛苦了）

2019-11-03    根据`v0.8.0`版本增加`Connections`说明