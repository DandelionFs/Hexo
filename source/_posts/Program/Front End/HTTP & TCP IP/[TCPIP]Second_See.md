---
title: '[TCP/IP] Second_See'
date: 2020-07-05 11:30:00
toc: true
---

## 0x00 网络的层次

**IP地址 & MAC地址**: 区别在于后者没有层次性. 

> 人们可以通过 NIC (Network Interface Card) 制造商识别号、制造商内部产品编号以及产品通用编号确保MAC地址的唯一性。然而，人们无法确定哪家厂商的哪个网卡被用到了哪个地方。虽然MAC地址是真正负责最终通信的地址，但是在实际寻址过程中，IP地址却必不可少。

**Ip地址**: 网络号+主机号

网络传输中，每个节点会根据分组数据的地址信息，来判断该报文应该由哪个网卡发送出去。为此，各个地址会参考一个发出接口列表。在这一点上MAC寻址与IP寻址是一样的。只不过MAC寻址中所参考的这张表叫做地址转发表，而IP寻址中所参考的叫做路由控制表( 自动生成 )。MAC地址转发表中所记录的是实际的MAC地址本身，而路由表中记录的IP地址则是集中了之后的网络号(网络号与子网掩码)。





> Q: 家用路由器是不是有交换机的功能？

A: 忽略wan口以后就成了一个有4个lan口的交换机. 事实上家用路由器由一个真路由器和一个交换机组成，路由器由两个端口(wan口，另外一个在内部与交换机相连，交换机露出4个Lan口)



<br><br>

## 0x01 网络构成

| 设备                      | 作用                                  |
| :-------------------------: | :--------------------------------- :|
| 网卡                      | 使计算机连网的设备(Network Interface) |
| 中继器(Repeater)          | 从物理层上延长网络的设备              |
| 网桥(Bridge) /2层交换机   | 从数据链路层上延长网络的设备          |
| 路由器(Router) /3层交换机 | 通过网络层转发分组数据的设备          |
| 4-7层交换机               | 处理传输层以上各层网络传输的设备      |
| 网关(Gateway)            | 转换协议的设备                        |

<br><br>

### DataLink

Datalink 指相互直连的设备之间进行通信所涉及的协议及其网络。为此，有众多传输介质与之对应。

| 数据链路名 | 通信媒介                  | 传输速率                             | 主用途  |
| ---------- | ------------------------- | ------------------------------------ | ------- |
| 以太网     | 同轴电缆                  | 10Mbps                               | LAN     |
| 以太网     | 双绞线电缆                | 10Mbps-100Gbps                       | LAN     |
| 以太网     | 光纤电缆                  | 10Mbps-100Gbps                       | LAN     |
| 无线       | 电磁波                    | 数个Mbps-                            | LAN-WAN |
| ATM        | 双绞线电缆 <br />光纤电缆 | 25 Mbps <br />155 Mbps <br />622Mbps | LAN-WAN |
| FDDI       | 光纤电缆 <br />双绞线电缆 | 100Mbps                              | LAN-MAN |
| 帧中继     | 双绞线电缆 <br />光纤电缆 | 约64k-1.5Mbps                        | WAN     |
| ISDN       | 双绞线电缆 <br />光纤电缆 | 64k-1. 5Mbps                         | WAN     |

注意:

1. **吞吐量:** 主机之间实际的传输速率被称作吞吐量。其单位与带宽相同，都是bps（Bits Per Second）。吞吐量这个词不仅衡量带宽，同时也衡量主机的CPU处理能力、网络的拥堵程度、报文中数据字段的占有份额（不含报文首部，只计算数据字段本身）等信息。

<br><br>

### 网卡 - NIC

网络接口卡、 网络适配器、网卡、LAN卡。

很多产品目录中都加入了“内置LAN端口”的参数，说明越来越多的计算机在出厂设置中就具备了以太网（Ethernet）1000BASE-T 或100BASE-TX的端口。没有配置NIC的计算机如果想接人以太网，至少得外接一个扩展槽以便插人NIC。无线局域网的情况下也是如此，计算机必须具备能够接人无线网的NIC才能保证连接到网络。笔记本电脑如果没有内置的NIC，可以通过ExpressCard或CardBus、压缩闪存以及USB方式插一块NIC以后再连网。

注意:

1. **ExpressCard：**笔记本电脑中的卡型扩展设备。由制定PC卡标准的PCMCIA{Personal Computer Memory Card International Association，PC机内存卡国际联合会）统一规格。
2. **CardBus: **PC卡, 旧称PCMCIA(**P**ersonal **C**omputer **M**emory **C**ard **I**nternational **A**ssociation), 又被谐称为“人们记不住计算机产业缩略词”（People Can't Memorize Computer Industry Acronyms）或“个人电脑制造商不能创造出个新的缩略词”（Personal Computer Manufacturers Can't Invent Acronyms）

<br><br>

### 中继器(Repeater)

在OSI模型的第1层一物理层面上延长网络的设备。由电缆传过来的电信号或光信号经由中继器的波形调整和放大再传给另一个电缆。

距离有限。如一个10Mbps的以太网最多可以用4个中继器分段连接，而一个100Mbps的以太网则最多只能连两个中继器。

可以提供多个端口服务。这种中继器被称作中继集线器或集线器(Hub,但现在人们常说的Hub更多是指交换式集线器)。因此，集线器也可以看作是多口中继器，每个端口都可以成为一个中继器。

注意:

1. 中继器无法连接一个 100Mbps 的以太网和另一个 0Mbps 的以太网。连接两个不同速度的网络需要的是网桥或路由器这样的设备。

<br><br>

### 网桥(Bridge) /2层交换机

第2层, 在数据链路上连接两个网络的设备

识别数据链路层中的数据帧(分组数据)，并将这些数据帧临时存储于内存，再重新生成信号作为一个全新的帧转发给相连的另一个网段。由于能够存储这些数据帧，网桥**能够连接10BASE—T与100BASE—TX等传输速率完全不同的数据链路**，**并且不限制连接网段的个数。**

数据链路的数据帧中有一个数据位叫做FCS，用以校验数据是否正确送达目的地。网桥通过检查这个域中的值，将那些损坏的数据丢弃，从而避免发送给其他的网段。此外，网桥还能通过**地址自学机制(**有些网桥能够判断是否将数据报文转发给相邻的网段，这种网桥被称作自学式网桥,	这类网桥会记住曾经通过自己转发的所有数据帧的MAC地址，并保存到自己里的内存表中。由此，可以判断哪个网段中包含持有哪类MAC地址的设备**)和过滤功能控制网络流量**(网络上传输的数据报文的数量).

这里所说的**地址是指MAC地址、硬件地址、物理地址以及适配器地址**，也就是网络上**针对NIC分配的具体地址**。主机A与主机B之间进行通信时，只针对主机A发送数据帧即可。网桥会根据地址自学机制来判断是否需要转发数据帧。

这类功能是OSI参考模型的第2层（数据链路层）所具有的功能。为此，有时也把网桥称作2层交换机（12交换机）。

以太网等网络中常使用交换集线器（Hub），现在基本也属于网桥的一种。交换集线器中连接电缆的每个端口都能提供类似网桥的功能。

注意:

1. FCS: 用CRC (Cyclic RedundancyCheck,循环冗余校验码)方式校验数据帧中的位。有时由于噪音导致通信传输当中数据信号越来越弱，而这种CRC正是用来检查数据帧是否因此而受到破坏的。
2. 具有网桥功能的Hub叫做交换集线器。只有中继器功能的Hub叫做集线器。

<br><br>

### 路由器(Router) /3层交换机

第3层, 在网络层面上连接两个网络、并对分组报文进行转发的设备。

网桥是根据物理地址（MAC地址）进行处理，而**路由器/3层交换机则是根据IP地址进行处理的。由此， TCP/IP中网络层的地址就成为了IP地址**。

路由器可以连接不同的数据链路。例如连接两个以太网，或一个以太网与一个FDDI。现在在家或办公室里连接互联网时所使用的宽带路由器也是路由器的一种。

路由器还有分担网络负荷的作用，甚至有些路由器具备一定的网络安全功能。

注意:

1. 由于路由器会分割数据链路，因此数据链路层的广播消息将无法继续传播。

<br><br>

### 4-7层交换机

处理从传输层至应用层的数据。如果用TCP/IP分层模型来表述， 4—7层交换机就是以TCP等协议的传输层及其上面的应用层为基础，分析收发数据，并对其进行特定的处理。

例如，对于并发访问量非常大的一个企业级Web站点，使用一台服务器不足以满足前端的访问需求，这时通常会架设多台服务器来分担。这些服务器前端访问的入口地址通常只有一个（企业为了使用者的方便，只会向最终用户开放一个统一的访问URL），为了能通过同一个URL将前端访问分发到后台多个服务器上，可以在这些服务器的前端加一个**负载均衡器**。这种负载均衡器就是4—7层交换机的一种。

**带宽控制**: 实际通信当中，人们希望在网络比较拥堵的时候，优先处理像语音这类对及时性要求较高的通信请求，放缓处理像邮件或数据转发等稍有延迟也并无大碍的通信请求。除此之外，还有很多。例如**广域网加速器**、**特殊应用访问加速以及防火墙**（可以防止互联网上的非法访问）等也有 4—7层交换机得到应用。

注意:

1. **负载均衡还可以通过DNS 实现**。通过对多个IP地址配置同一个名字，每次查询到这个名字的客户得到其中的某一个地址，从而使不同客户访问不同的服务器。该方法也称作循环复用DNS技术。

<br><br>

### 网关(Gateway)

从传输层到应用层的数据**进行(不同协议)转换和转发的设备**。与4—7层交换机一样都是处理传输层及以上的数据，但是网关不仅**转发数据**还负责对**数据进行转换**，它通常会使用一个表示层或应用层网关，在两个不能进行直接通信的协议之间进行翻译，最终实现两者之间的通信。

一个非常典型的例子就是互联网邮件与手机邮件之间的转换服务。手机邮件有时可能会与互联网邮件互不兼容，这是由于它们在表示层和应用层中的“电子邮件协议”互不相同所导致的。那么，为什么连到互联网的电脑与手机之间能够互发电子邮件呢？互联网与手机之间设置了一道网关。网关负责读取完各种不同的协议后，对它们逐一进行合理的转换，再将相应的数据转发出去。这样一来即使应用的是不同电子邮件的协议，计算机与手机之间也能互相发送邮件。

<br><br>

## 